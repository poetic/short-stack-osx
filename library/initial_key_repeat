#!/usr/bin/ruby
# WANT_JSON

require 'rubygems'
require 'json'

plist   = 'NSGlobalDomain'
key     = 'InitialKeyRepeat'
default = '8'

File.open(ARGV[0]) do |fh|

  data           = JSON.parse(fh.read)
  data[:value] ||= default
  plist_read     = `defaults read #{plist} #{key}`
  response       = {changed: false}

  if plist_read.split.join != data[:value]
    `defaults write #{plist} #{key} -int #{data[:value]}`
    response[:changed] = true
  end

  print JSON.dump(response)
end
