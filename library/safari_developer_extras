#!/usr/bin/ruby
# WANT_JSON

require 'rubygems'
require 'json'
require "#{File.expand_path('~')}/.short-stack/.galaxy/short-stack-osx/library/lib/osx_write"

File.open(ARGV[0]) do |fh|
  data       = JSON.parse(fh.read)
  value      = data['value'] ? Plist::Parser.parse_value(data['value']) : true
  response   = {'changed' => false}
  plist_set  = Plist::Parser.new('com.apple.Safari', 'WebKitDeveloperExtrasEnabledPreferenceKey', value)

  unless plist_set.exists
    plist_set.write
    response['changed'] = true
  end

  print JSON.dump(response)
end
