#!/usr/bin/ruby
# WANT_JSON

require 'rubygems'
require 'json'

plist   = 'com.apple.Safari'
key     = 'WebKitDeveloperExtrasEnabledPreferenceKey'
default = 'true'

File.open(ARGV[0]) do |fh|

  data           = JSON.parse(fh.read)
  data[:value] ||= default
  read_value     = data[:value] =~ /true/i ? '1' : '0'
  plist_read     = `defaults read #{plist} #{key}`
  response       = {changed: false}

  if plist_read.split.join != read_value
    `defaults write #{plist} #{key} -bool #{data[:value]}`
    response[:changed] = true
  end

  print JSON.dump(response)
end
