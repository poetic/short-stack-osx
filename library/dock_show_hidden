#!/usr/bin/ruby
# WANT_JSON

require 'rubygems'
require 'json'
require "#{File.expand_path('~')}/.short-stack/.galaxy/osx/library/lib/osx_write"

File.open(ARGV[0]) do |fh|
  data      = JSON.parse(fh.read)
  response  = {'changed' => false}
  value     = data['value'] ? Plist::Parser.parse_value(data['value']) : true
  plist_set = Plist::Parser.new('com.apple.dock', 'showhidden', value)

  unless plist_set.exists
    plist_set.write
    response['changed'] = true
  end

  print JSON.dump(response)
end
