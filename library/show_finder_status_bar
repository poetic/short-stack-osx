#!/usr/bin/ruby
# WANT_JSON

require 'rubygems'
require 'json'

File.open(ARGV[0]) do |fh|

  data          = JSON.parse(fh.read)
  data[:value]  ||= 'true'
  read_value    = data[:value] =~ /true/i ? '1' : '0'
  response      = {changed: false}

  plist_read    = `defaults read com.apple.finder ShowStatusBar`

  if plist_read.split.join != read_value
    `defaults write com.apple.finder ShowStatusBar -bool #{data[:value]}`
    response[:changed] = true
  end

  print JSON.dump(response)
end
